webpackJsonp([30,32],{242:function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(33),i=(o(a),n(30)),r=o(i),s=n(45),l=o(s),c=n(65),d=(o(c),n(64)),u=o(d),p=n(42),g=(o(p),n(39)),f=o(g),v=n(9),m=(o(v),n(5)),h=(o(m),n(8)),w=o(h),A=n(1),y=o(A),C=n(35),b=o(C);y.default.use(w.default),y.default.use(f.default),y.default.use(u.default),e.default={name:"gv-draw-panel",data:function(){var t=GV.config.getToolOptions("gv-draw-button");return{options:t,title:"Acquisizione Geometrie",pointClass:"el-button--default el-button--mini el-button gv-color-scheme ms fg-point",lineClass:"el-button--default el-button--mini el-button gv-color-scheme ms fg-polyline-pt",areaClass:"el-button--default el-button--mini el-button gv-color-scheme ms fg-polygon-pt",modifyClass:"el-button--default el-button--mini el-button gv-color-scheme fa fa-edit",deleteClass:"el-button--default el-button--mini el-button gv-color-scheme el-icon-delete",style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#ffcc33"})})}),type:null,layer:null,interaction:null,snap:!0,snapInteraction:!0,deletedItems:[],idLayer:t.idLayer,submitButton:t.buttons&&t.buttons.submit,cancelButton:t.buttons&&t.buttons.cancel,refreshButton:t.buttons&&t.buttons.refresh,pointButton:t.tools&&t.tools.draw&&t.tools.draw.point,lineButton:t.tools&&t.tools.draw&&t.tools.draw.polyline,polygonButton:t.tools&&t.tools.draw&&t.tools.draw.polygon,modifyButton:t.tools&&t.tools.edit&&t.tools.edit.edit,deleteButton:t.tools&&t.tools.edit&&t.tools.edit.remove}},computed:{},methods:{setButtonClass:function(t){document.getElementById("gv-draw-Point").className=this.pointClass,document.getElementById("gv-draw-LineString").className=this.lineClass,document.getElementById("gv-draw-Polygon").className=this.areaClass,document.getElementById("gv-draw-modify").className=this.modifyClass,document.getElementById("gv-draw-delete").className=this.deleteClass,t&&(document.getElementById("gv-draw-"+t).className+=" gv-button-selected")},draw:function(t){switch(this.type=t,this.setButtonClass(null),this.setButtonClass(t),GV.app.map.getOverlays().clear(),this.interaction&&GV.app.map.removeInteraction(this.interaction),t){case"modify":this.addInteractionModify();break;case"delete":this.addInteractionDelete();break;default:this.addInteractionDraw(t)}},pointerMoveHandler:function(t){if(!t.dragging){var e="Click per disegnare";if(this.sketch){var n=this.sketch.getGeometry();n instanceof ol.geom.Polygon?e=this.continuePolygonMsg:n instanceof ol.geom.LineString&&(e=this.continueLineMsg)}this.helpTooltipElement.innerHTML=e,this.helpTooltip.setPosition(t.coordinate),this.helpTooltipElement.classList.remove("hidden")}},setSnapInteraction:function(){this.snap?(this.snapInteraction=new ol.interaction.Snap({source:this.layer.getSource()}),GV.app.map.addInteraction(this.snapInteraction)):GV.app.map.removeInteraction(this.snapInteraction)},addInteractionModify:function(){this.interaction=new ol.interaction.Modify({source:this.layer.getSource()}),GV.app.map.addInteraction(this.interaction),this.setSnapInteraction()},addInteractionDelete:function(){var t=this;this.interaction=new ol.interaction.Select({source:this.layer.getSource()}),GV.app.map.addInteraction(this.interaction),this.setSnapInteraction(),this.interaction.on("select",function(e){var n=e.target.getFeatures().getArray()[0];t.layer.getSource().removeFeature(n),t.deletedItems.push(n)})},addInteractionDraw:function(t){var e=this;this.interaction=new ol.interaction.Draw({source:this.layer.getSource(),type:t,style:this.style}),GV.app.map.addInteraction(this.interaction),this.setSnapInteraction(),this.interaction.on("drawstart",function(t){console.log("drawstart")}),this.interaction.on("drawend",function(t){var n=t.feature;if(console.log("drawend",n),!e.options.multiGeom){var o=!0,a=!1,i=void 0;try{for(var r,s=(0,l.default)(e.layer.getSource().getFeatures());!(o=(r=s.next()).done);o=!0){var c=r.value;console.log(c),e.layer.getSource().removeFeature(c)}}catch(t){a=!0,i=t}finally{try{!o&&s.return&&s.return()}finally{if(a)throw i}}}console.log("drawend 2",e.layer.getSource().getFeatures())})},addLayerFeatures:function(t){var e=this;this.layer.getSource().clear(!0);var n=!0,o=!1,a=void 0;try{for(var i,r=(0,l.default)(t);!(n=(i=r.next()).done);n=!0){var s=i.value;(0,b.default)(null,null,s.wfsURL).then(function(t){if(t&&t.length>0){var n=e.layer.getSource(),o=!0,a=!1,i=void 0;try{for(var r,s=(0,l.default)(t);!(o=(r=s.next()).done);o=!0){var c=r.value;if(c.geometry){var d=(new ol.format.GeoJSON).readFeature(c,{featureProjection:"EPSG:3857"});n.addFeature(d)}}}catch(t){a=!0,i=t}finally{try{!o&&s.return&&s.return()}finally{if(a)throw i}}GV.app.map.fit(n.getExtent(),{maxZoom:17})}}).catch(function(t){console.error(t)})}}catch(t){o=!0,a=t}finally{try{!n&&r.return&&r.return()}finally{if(o)throw a}}},clear:function(){GV.app.map.getOverlays().clear(),GV.app.map.removeInteraction(this.interaction),GV.app.map.removeInteraction(this.snapInteraction),this.setButtonClass(null)},cancel:function(){this.options.cancel&&this.options.cancel()},confirmRefresh:function(){var t=confirm("L'operazione cancella eventuali modifiche non salvate su DB.\n\nSei sicuro?");1==t&&this.refresh()},refresh:function(){this.layer.getSource().clear(),this.deletedItems=[],this.options.initWfsRequests&&this.addLayerFeatures(this.options.initWfsRequests),this.refreshWMS()},refreshWMS:function(){var t=GV.app.map.getLayerByName(this.idLayer);if(t){var e=t.getSource().getParams();t.getSource().updateParams(e)}},confirmSubmit:function(){var t=confirm("Sei sicuro?");1==t&&this.submit()},submit:function(){this.loading=r.default.service({text:"Salvataggio...",background:"rgba(0, 0, 0, 0.8)"});var t=(new ol.format.GeoJSON).writeFeaturesObject(this.layer.getSource().getFeatures()),e=(new ol.format.GeoJSON).writeFeaturesObject(this.deletedItems);console.log("submit",t,e),this.options.submit(t,e,this.loading,this.refresh)}},mounted:function(){var t=this;GV.eventBus.$on("gv-control-draw-activate",function(e){console.log("gv-control-draw-activate"),t.layer.setVisible(!0)}),GV.eventBus.$on("gv-control-draw-deactivate",function(e){console.log("gv-control-draw-deactivate"),t.clear(),t.layer.setVisible(!1)}),this.layer=new ol.layer.Vector({source:new ol.source.Vector,style:this.style,zIndex:800}),GV.app.map.addLayer(this.layer),this.options.initWfsRequests&&this.addLayerFeatures(this.options.initWfsRequests),GV.app.map.clearLayer("InfoWmsHilite")}}},471:function(t,e,n){e=t.exports=n(2)(),e.push([t.id,".gv-draw-panel{position:absolute;width:260px;left:0;top:0;margin-left:10px;margin-top:50px;z-index:800}.gv-draw-panel-body{padding:10px;overflow-y:auto;width:240px;height:25px}.gv-draw-panel-result{position:absolute;padding-left:3px;margin:0;width:230px}.gv-draw-buttons{width:20px;float:left;margin:4px}.gv-draw-buttons-reset{width:36px;padding-left:2px}#gv-draw-modify{margin-left:25px}#gv-draw-delete,#gv-draw-modify{padding-top:5.8px}.el-row{padding:5px 5px 5px 10px}","",{version:3,sources:["/./src/components/DrawOL.vue"],names:[],mappings:"AACA,eACE,kBAAmB,AACnB,YAAa,AACb,OAAU,AACV,MAAS,AACT,iBAAkB,AAClB,gBAAiB,AACjB,WAAa,CACd,AACD,oBACE,aAAc,AACd,gBAAiB,AACjB,YAAa,AACb,WAAa,CACd,AACD,sBACE,kBAAmB,AACnB,iBAAkB,AAClB,SAAY,AACZ,WAAa,CACd,AACD,iBACE,WAAY,AACZ,WAAY,AACZ,UAAY,CACb,AACD,uBACE,WAAY,AACZ,gBAAkB,CACnB,AACD,gBACE,gBAAkB,CAEnB,AACD,gCAFE,iBAAmB,CAIpB,AACD,QACE,wBAA0B,CAC3B",file:"DrawOL.vue",sourcesContent:["\n.gv-draw-panel {\r\n  position: absolute;\r\n  width: 260px;\r\n  left: 0px;\r\n  top: 0px;\r\n  margin-left: 10px;\r\n  margin-top: 50px;\r\n  z-index: 800;\n}\n.gv-draw-panel-body {\r\n  padding: 10px;\r\n  overflow-y: auto;\r\n  width: 240px;\r\n  height: 25px;\n}\n.gv-draw-panel-result {\r\n  position: absolute;\r\n  padding-left: 3px;\r\n  margin: 0px;\r\n  width: 230px;\n}\n.gv-draw-buttons {\r\n  width: 20px;\r\n  float: left;\r\n  margin: 4px;\n}\n.gv-draw-buttons-reset {\r\n  width: 36px;\r\n  padding-left: 2px;\n}\n#gv-draw-modify {\r\n  margin-left: 25px;\r\n  padding-top: 5.8px;\n}\n#gv-draw-delete {\r\n  padding-top: 5.8px;\n}\n.el-row {\r\n  padding: 5px 5px 5px 10px;\n}\r\n"],sourceRoot:"webpack://"}])},590:function(t,e,n){var o=n(471);"string"==typeof o&&(o=[[t.id,o,""]]);n(3)(o,{});o.locals&&(t.exports=o.locals)},640:function(t,e,n){var o,a;n(590),o=n(242);var i=n(781);a=o=o||{},"object"!=typeof o.default&&"function"!=typeof o.default||(a=o=o.default),"function"==typeof a&&(a=a.options),a.render=i.render,a.staticRenderFns=i.staticRenderFns,t.exports=o},781:function(t,e){t.exports={render:function(){var t=this;t.$createElement;return t._c("div",{staticClass:"gv-draw-panel",attrs:{id:"gv-draw-panel"}},[t._c("gv-title",{directives:[{name:"draggable",rawName:"v-draggable"}],attrs:{title:t.title,divId:"gv-draw-panel",noClose:!0}}),t._v(" "),t._c("div",{staticClass:"gv-draw-panel-body gv-inverted-color-scheme",attrs:{id:"gv-draw-panel-body"}},[t._c("el-button",{directives:[{name:"show",rawName:"v-show",value:t.pointButton,expression:"pointButton"}],staticClass:"gv-color-scheme fg-point",attrs:{id:"gv-draw-Point",title:"Disegna punto",size:"mini"},on:{click:function(e){t.draw("Point")}}}),t._v(" "),t._c("el-button",{directives:[{name:"show",rawName:"v-show",value:t.lineButton,expression:"lineButton"}],staticClass:"gv-color-scheme fg-polyline-pt",attrs:{id:"gv-draw-LineString",title:"Disegna linea",size:"mini"},on:{click:function(e){t.draw("LineString")}}}),t._v(" "),t._c("el-button",{directives:[{name:"show",rawName:"v-show",value:t.polygonButton,expression:"polygonButton"}],staticClass:"gv-color-scheme fg-polygon-pt",attrs:{id:"gv-draw-Polygon",title:"Disegna poligono",size:"mini"},on:{click:function(e){t.draw("Polygon")}}}),t._v(" "),t._c("el-button",{directives:[{name:"show",rawName:"v-show",value:t.modifyButton,expression:"modifyButton"}],staticClass:"gv-color-scheme fa fa-edit",attrs:{id:"gv-draw-modify",title:"Modifica",size:"mini"},on:{click:function(e){t.draw("modify")}}}),t._v(" "),t._c("el-button",{directives:[{name:"show",rawName:"v-show",value:t.deleteButton,expression:"deleteButton"}],staticClass:"gv-color-scheme el-icon-delete",attrs:{id:"gv-draw-delete",title:"Cancella",size:"mini"},on:{click:function(e){t.draw("delete")}}})],1),t._v(" "),t._c("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"left"}},[t._c("el-checkbox",{on:{change:t.setSnapInteraction},model:{value:t.snap,callback:function(e){t.snap=e},expression:"snap"}},[t._v("Snap")])],1),t._v(" "),t._c("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"left"}},[t._c("el-button",{staticClass:"gv-color-scheme",attrs:{id:"gv-draw-submit",title:"Salva i dati sul DB",size:"mini"},on:{click:t.confirmSubmit}},[t._v("Salva su DB")]),t._v(" "),t._c("el-button",{directives:[{name:"show",rawName:"v-show",value:t.cancelButton,expression:"cancelButton"}],staticClass:"gv-color-scheme",attrs:{id:"gv-draw-cancel",title:"Ritorno alla applicazione",size:"mini"},on:{click:t.cancel}},[t._v("Annulla")]),t._v(" "),t._c("el-button",{directives:[{name:"show",rawName:"v-show",value:t.refreshButton,expression:"refreshButton"}],staticClass:"gv-color-scheme",attrs:{id:"gv-draw-cancel",title:"Ricarica dati salvati sul DB",size:"mini"},on:{click:t.confirmRefresh}},[t._v("Ricarica")])],1)],1)},staticRenderFns:[]}}});
//# sourceMappingURL=30.js.map