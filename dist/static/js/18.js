webpackJsonp([18,33],{258:function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=i(29),o=(r(a),i(28)),n=r(o),l=i(187),s=(r(l),i(183)),p=r(s),c=i(42),u=(r(c),i(39)),d=r(u),f=i(9),A=(r(f),i(5)),_=(r(A),i(8)),h=r(_),g=i(1),v=r(g),C=i(50),y=(r(C),i(30)),b=r(y),m=i(101),S=r(m),L=i(35),T=r(L),O=i(370),P=r(O);v.default.use(h.default),v.default.use(d.default),v.default.use(p.default),t.default={name:"gv-genio-seleziona-particelle-panel",data:function(){return{particelleSelezionate:[],hiliteLayer:null,geojsonLayerList:[],options:GV.config.getToolOptions("gv-genio-seleziona-particelle-button")}},computed:{buttonDisabled:function(){return!1}},methods:{refresh:function(){this.loadParticelle()},editableRow:function(e){return"M"===e},submit:function(){var e=confirm("Sei sicuro?");1==e&&this.saveData()},saveData:function(){var e=this,t=this.particelleSelezionate.map(function(e){return e.properties.id=e.id,e.properties}),i={prov:this.options.prov,codicePratica:this.options.codicePratica,listaParticelle:t,idPunto:this.options.idPunto},r=n.default.service({text:"Salvataggio dati...",background:"rgba(0, 0, 0, 0.8)"});(0,P.default)(i).then(function(t){r&&r.close(),t.success?(GV.utils.notification("Dati salvati correttamente","info"),e.reloadLayer()):GV.utils.notification("Errore nella scrittura sul DB","error")})},reloadLayer:function(){var e=GV.globals.GW_CONFIG[this.options.prov].idLayerPratica;(this.options.codicePratica.startsWith("GDE")||this.options.codicePratica.startsWith("IMD")||this.options.codicePratica.startsWith("SVD")||this.options.codicePratica.startsWith("SPD"))&&(e=GV.globals.GW_CONFIG[this.options.prov].idLayerPraticaDe),this.options.idPunto&&(e=GV.globals.GW_CONFIG[this.options.prov].idLayerEttariIrrigati);var t=GV.config.getLayerConfig(e);GV.eventBus.$emit("set-layer-visible",{layer:t,checked:!1}),GV.eventBus.$emit("set-layer-visible",{layer:t,checked:!0})},loadLayer:function(){GV.app.map.loadLayers([{name:"SelezioneParticelle",type:"JSON",style:{color:"#ff0000",fillOpacity:0,weight:3,opacity:.7},visible:!0}]),this.hiliteLayer=GV.app.map.getLayerByName("SelezioneParticelle"),this.loadParticelle()},loadParticelle:function(){var e=this;this.hiliteLayer.clearLayers(),this.particelleSelezionate=[];var t="M"+this.options.idMap,i=void 0,r=void 0;this.options.idPunto?(i="SV06_CODICE_PRATICA = '"+this.options.codicePratica+"' AND SV06_COD_COM IS NOT NULL",r=this.options.idLayerEttariIrrigati):(i="CODICE_PRATICA = '"+this.options.codicePratica+"' AND MAPPALE IS NOT NULL",r=this.options.idLayerPratica);var a="https://geoservizi.regione.liguria.it/geoserver/wfs?service=WFS&version=2.0.0&request=GetFeature&srsName=EPSG%3A4326&outputFormat=application%2Fjson&typeName="+t+":"+r+"&cql_filter="+i;(0,T.default)(null,null,a).then(function(t){t.forEach(function(t){var i=t.properties.COD_COM||t.properties.SV06_COD_COM,r=t.properties.SEZ||t.properties.SV06_SEZ,a=t.properties.FOGLIO||t.properties.SV06_FOGLIO,o=t.properties.MAPPALE||t.properties.SV06_MAPPALE,n=t.properties.ALLEGATO||t.properties.SV06_ALLEGATO,l=t.properties.SVILUPPO||t.properties.SV06_SVILUPPO,s=t.properties.PROT_DBTI||t.properties.SV06_PROT_DBTI,p=t.properties.DATA_DBTI||t.properties.SV06_DATA_DBTI,c=t.properties.DATA_SEL||t.properties.SV06_DATA_SEL,u=t.properties.AREA||t.properties.SV06_AREA,d=t.properties.G_STATO||t.properties.SV06_STATO,f=t.properties.MAPPALE_PARZIALE||t.properties.SV06_MAPPALE_PARZIALE,A={type:"Feature",id:t.id,geometry:t.geometry,bbox:t.bbox,geometry_name:t.geometry_name,properties:{CT24_ID:null,CT24_COD_COM:i,CT24_SEZ:r,CT24_FOGLIO:a,CT24_NUMERO:o,CT24_ALLEGATO:n,CT24_SVILUPPO:l,CT24_PROT_IN:s,CT24_DATA_AGG:p,DATA_SEL:c,AREA:u,STATO:d,parziale:!!f}};A.label=A.properties.CT24_COD_COM+"/"+A.properties.CT24_SEZ+"/"+A.properties.CT24_FOGLIO+"/"+A.properties.CT24_NUMERO.trim()+"/"+A.properties.CT24_ALLEGATO+"/"+A.properties.CT24_SVILUPPO,A.id=A.label,e.particelleSelezionate.push(A),e.hiliteLayer.addData(A)})})},getWmsUrl:function(e){return this.layerConfig?(this.layerConfig.wmsParams.infoFormat="application/json",this.layerConfig.infoBuffer=0,b.default.getGetFeatureInfoUrl(this.layerConfig,e)):void console.error("Configurazione Layer non trovata")},updateParticelleSelezionate:function(e){var t=this;e.forEach(function(e){t.setFeatureProperties(e),t.notEditable(e)||(t.alreadySelected(e)?(t.particelleSelezionate=t.particelleSelezionate.filter(function(t){return t.id!==e.id}),t.hiliteLayer.eachLayer(function(t){t.feature.id==e.id&&GV.app.map.removeLayer(t)})):(t.particelleSelezionate.push(e),t.updateLayer(e)))})},setFeatureProperties:function(e){e.properties.DATA_SEL="",e.properties.STATO="M",e.label=e.properties.CT24_COD_COM?e.properties.CT24_COD_COM+"/"+e.properties.CT24_SEZ+"/"+e.properties.CT24_FOGLIO+"/"+e.properties.CT24_NUMERO.trim()+"/"+e.properties.CT24_ALLEGATO+"/"+e.properties.CT24_SVILUPPO:e.properties.ct24_cod_com+"/"+e.properties.ct24_sez+"/"+e.properties.ct24_foglio+"/"+e.properties.ct24_numero.trim()+"/"+e.properties.ct24_allegato+"/"+e.properties.ct24_sviluppo,e.id=e.label,e.properties.parziale=!1,e.properties.catalogo=!0,e.properties.AREA=e.properties.CT24_AREA?e.properties.CT24_AREA:e.properties.ct24_area},updateLayer:function(e,t){var i=this,r="ct24_id = "+e.properties.CT24_ID,a="https://geoservizi.regione.liguria.it/geoserver/wfs?service=WFS&version=2.0.0&request=GetFeature&srsName=EPSG%3A4326&outputFormat=application%2Fjson&typeName=M1047:L2624&cql_filter="+r;(0,T.default)(null,null,a).then(function(e){e.forEach(function(e){i.setFeatureProperties(e),i.hiliteLayer.addData(e)})})},notEditable:function e(t){var e=!1;return this.particelleSelezionate.forEach(function(i){t.id===i.id&&"M"!==i.properties.STATO&&(e=!0)}),e},alreadySelected:function(e){var t=!1;return this.particelleSelezionate.forEach(function(i){e.id===i.id&&(t=!0)}),t},handleDelete:function(e,t){this.particelleSelezionate=this.particelleSelezionate.filter(function(e){return e.id!==t.id}),this.hiliteLayer.eachLayer(function(e){e.feature.id==t.id&&GV.app.map.removeLayer(e)})},selectRiga:function(e){e&&this.hiliteLayer.eachLayer(function(t){t.feature.id==e.id?t.setStyle({fillOpacity:.4}):t.setStyle({fillOpacity:0})})},deselectRiga:function(e){e&&this.hiliteLayer.eachLayer(function(t){t.feature.id==e.id&&t.setStyle({fillOpacity:0})})},subscribeMapEvent:function(e){var t=this;GV.app.map.on("click",function(e){var i=t.getWmsUrl(e);(0,S.default)(i).then(function(e){return t.updateParticelleSelezionate(e)})})},hideLayer:function(){this.hiliteLayer.eachLayer(function(e){e.getElement().style.display="none"})},showLayer:function(){this.hiliteLayer.eachLayer(function(e){e.getElement().style.display="block"})}},mounted:function(){var e=this;this.layerConfig=GV.config.getLayerConfig(this.options.idLayerParticella),this.layerConfig||GV.eventBus.$on("gv-config-init",function(t){e.layerConfig=GV.config.getLayerConfig(e.options.idLayerParticella)}),this.loadLayer(),GV.eventBus.$on("gv-control-genio-seleziona-particelle-activate",function(t){e.subscribeMapEvent(t),e.showLayer(),e.loadParticelle()}),GV.eventBus.$on("gv-control-genio-seleziona-particelle-deactivate",function(t){GV.app.map.off("click"),e.hideLayer()}),this.subscribeMapEvent(event)}}},370:function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return o.default.post("/geoservices/REST/genioweb/insert_particelle",{headers:{Accept:"text/xml"},data:e}).then(function(e){return e.data})};var a=i(4),o=r(a)},433:function(e,t,i){t=e.exports=i(2)(),t.push([e.id,".gv-genio-seleziona-particelle-panel{position:absolute;width:560px;left:0;top:0;margin-left:10px;margin-top:50px;z-index:800}.gv-genio-seleziona-particelle-body{padding:5px;width:550px;height:350px}.gv-genio-seleziona-particelle-table{padding:5px;width:540px;height:200px;max-height:410px}.el-table__body-wrapper{max-height:300px!important;overflow-y:auto}.el-table{font-size:10px!important}","",{version:3,sources:["/./src/components/GenioSelezionaParticelle.vue"],names:[],mappings:"AACA,qCACE,kBAAmB,AACnB,YAAa,AACb,OAAU,AACV,MAAS,AACT,iBAAkB,AAClB,gBAAiB,AACjB,WAAa,CACd,AACD,oCACE,YAAa,AACb,YAAa,AACb,YAAc,CACf,AACD,qCACE,YAAa,AACb,YAAa,AACb,aAAc,AACd,gBAAkB,CACnB,AACD,wBACE,2BAA6B,AAC7B,eAAiB,CAClB,AACD,UACE,wBAA2B,CAC5B",file:"GenioSelezionaParticelle.vue",sourcesContent:["\n.gv-genio-seleziona-particelle-panel {\r\n  position: absolute;\r\n  width: 560px;\r\n  left: 0px;\r\n  top: 0px;\r\n  margin-left: 10px;\r\n  margin-top: 50px;\r\n  z-index: 800;\n}\n.gv-genio-seleziona-particelle-body {\r\n  padding: 5px;\r\n  width: 550px;\r\n  height: 350px;\n}\n.gv-genio-seleziona-particelle-table {\r\n  padding: 5px;\r\n  width: 540px;\r\n  height: 200px;\r\n  max-height: 410px;\n}\n.el-table__body-wrapper {\r\n  max-height: 300px !important;\r\n  overflow-y: auto;\n}\n.el-table {\r\n  font-size: 10px !important;\n}\r\n"],sourceRoot:"webpack://"}])},513:function(e,t,i){var r=i(433);"string"==typeof r&&(r=[[e.id,r,""]]);i(3)(r,{});r.locals&&(e.exports=r.locals)},659:function(e,t,i){var r,a;i(513),r=i(258);var o=i(721);a=r=r||{},"object"!=typeof r.default&&"function"!=typeof r.default||(a=r=r.default),"function"==typeof a&&(a=a.options),a.render=o.render,a.staticRenderFns=o.staticRenderFns,e.exports=r},721:function(e,t){e.exports={render:function(){var e=this;e.$createElement;return e._c("div",{staticClass:"gv-genio-seleziona-particelle-panel",attrs:{id:"gv-genio-seleziona-particelle-panel"}},[e._c("gv-title",{directives:[{name:"draggable",rawName:"v-draggable"}],attrs:{title:"Seleziona Particelle",divId:"gv-genio-seleziona-particelle-panel",noClose:!0}}),e._v(" "),e._c("div",{staticClass:"gv-genio-seleziona-particelle-body gv-inverted-color-scheme"},[e._c("div",{staticClass:"gv-genio-seleziona-particelle-table"},[e._c("el-table",{attrs:{data:e.particelleSelezionate,"empty-text":"Nessuna particella selezionata","highlight-current-row":"","cell-style":{padding:"2px",maxHeight:"10px"}},on:{"cell-mouse-enter":e.selectRiga,"cell-mouse-leave":e.deselectRiga}},[e._c("el-table-column",{attrs:{label:"ESTREMI",align:"center",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._c("el-popover",{attrs:{trigger:"hover",placement:"bottom"}},[e._c("p",[e._v("COMUNE: "+e._s(t.row.properties.CT24_COD_COM))])]),e._v(" "),e._c("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[e._v(e._s(t.row.label))])]}}])}),e._v(" "),e._c("el-table-column",{attrs:{label:"PROT",align:"center",width:"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._c("span",[e._v(e._s(t.row.properties.CT24_PROT_IN))])]}}])}),e._v(" "),e._c("el-table-column",{attrs:{label:"DATA DBTI",align:"center",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._c("span",[e._v(e._s(t.row.properties.CT24_DATA_AGG.substr(0,10)))])]}}])}),e._v(" "),e._c("el-table-column",{attrs:{label:"DATA SEL",align:"center",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._c("span",[e._v(e._s(t.row.properties.DATA_SEL.substr(0,10)))])]}}])}),e._v(" "),e._c("el-table-column",{attrs:{label:"AREA",align:"center",width:"50"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._c("span",[e._v(e._s(t.row.properties.AREA))])]}}])}),e._v(" "),e._c("el-table-column",{attrs:{label:"PARZ.",align:"center",width:"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._c("span",[e._c("el-checkbox",{directives:[{name:"show",rawName:"v-show",value:e.editableRow(t.row.properties.STATO),expression:"editableRow(scope.row.properties.STATO)"}],model:{value:t.row.properties.parziale,callback:function(i){e.$set(t.row.properties,"parziale",i)},expression:"scope.row.properties.parziale"}})],1)]}}])}),e._v(" "),e._c("el-table-column",{attrs:{width:"46"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._c("el-button",{directives:[{name:"show",rawName:"v-show",value:e.editableRow(t.row.properties.STATO),expression:"editableRow(scope.row.properties.STATO)"}],attrs:{size:"mini",type:"danger",icon:"el-icon-delete"},on:{click:function(i){e.handleDelete(t.$index,t.row)}}})]}}])})],1)],1)]),e._v(" "),e._c("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"left"}},[e._c("el-button",{ref:"button",attrs:{id:"gv-genio-seleziona-particelle-panel-submit",title:"Salva i dati sul DB",type:"primary",size:"mini",disabled:e.buttonDisabled},on:{click:function(t){e.submit()}}},[e._c("span",[e._v("Salva su DB")])]),e._v(" "),e._c("el-button",{staticClass:"gv-color-scheme",attrs:{id:"gv-draw-cancel",title:"Ricarica dati salvati sul DB",size:"mini"},on:{click:e.refresh}},[e._v("Ricarica")])],1)],1)},staticRenderFns:[]}}});
//# sourceMappingURL=18.js.map