webpackJsonp([36,38],{269:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(92),r=o(a),i=n(24),s=(o(i),n(23)),l=o(s),c=n(22),d=o(c),u=n(21),p=o(u),f=n(32),v=o(f),g=n(67),m=(o(g),n(65)),h=o(m),w=n(36),y=(o(w),n(34)),x=o(y),A=n(9),C=(o(A),n(5)),b=(o(C),n(8)),B=o(b),E=n(1),S=o(E),I=n(37),_=o(I),G=n(45),k=o(G),V=n(2),F=o(V);S.default.use(B.default),S.default.use(x.default),S.default.use(h.default),t.default={name:"gv-draw-panel",data:function(){var e=GV.config.getToolOptions("gv-draw-button");return{options:e,title:"Acquisizione Geometrie",pointClass:"el-button--default el-button--mini el-button gv-color-scheme ms fg-point",lineClass:"el-button--default el-button--mini el-button gv-color-scheme ms fg-polyline-pt",areaClass:"el-button--default el-button--mini el-button gv-color-scheme ms fg-polygon-pt",modifyClass:"el-button--default el-button--mini el-button gv-color-scheme fa fa-edit",deleteClass:"el-button--default el-button--mini el-button gv-color-scheme el-icon-delete",style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#ffcc33"})})}),type:null,layer:null,interaction:null,snap:!0,snapInteraction:!0,deletedItems:[],idLayer:e.idLayer,submitButton:e.buttons&&e.buttons.submit,cancelButton:e.buttons&&e.buttons.cancel,refreshButton:e.buttons&&e.buttons.refresh,pointButton:e.tools&&e.tools.draw&&e.tools.draw.point,lineButton:e.tools&&e.tools.draw&&e.tools.draw.polyline,polygonButton:e.tools&&e.tools.draw&&e.tools.draw.polygon,modifyButton:e.tools&&e.tools.edit&&e.tools.edit.edit,deleteButton:e.tools&&e.tools.edit&&e.tools.edit.remove,vertexEditorFeature:null,vertexEditorGeomType:null,showVertexEditor:!1,vertexIndex:-1,vertexX:0,vertexY:0,vertexMarker:null}},computed:{},methods:{setButtonClass:function(e){document.getElementById("gv-draw-Point").className=this.pointClass,document.getElementById("gv-draw-LineString").className=this.lineClass,document.getElementById("gv-draw-Polygon").className=this.areaClass,document.getElementById("gv-draw-modify").className=this.modifyClass,document.getElementById("gv-draw-delete").className=this.deleteClass,e&&(document.getElementById("gv-draw-"+e).className+=" gv-button-selected")},draw:function(e){switch(this.type=e,this.setButtonClass(null),this.setButtonClass(e),GV.app.map.getOverlays().clear(),this.interaction&&GV.app.map.removeInteraction(this.interaction),e){case"modify":this.addInteractionModify();break;case"delete":this.addInteractionDelete();break;default:this.addInteractionDraw(e)}},pointerMoveHandler:function(e){if(!e.dragging){var t="Click per disegnare";if(this.sketch){var n=this.sketch.getGeometry();n instanceof ol.geom.Polygon?t=this.continuePolygonMsg:n instanceof ol.geom.LineString&&(t=this.continueLineMsg)}this.helpTooltipElement.innerHTML=t,this.helpTooltip.setPosition(e.coordinate),this.helpTooltipElement.classList.remove("hidden")}},setSnapInteraction:function(){this.snap?(this.snapInteraction=new ol.interaction.Snap({source:this.layer.getSource()}),GV.app.map.addInteraction(this.snapInteraction)):GV.app.map.removeInteraction(this.snapInteraction)},submitVertexEditor:function(){var e=this;(0,k.default)(this.options.epsg,"3857",this.vertexX,this.vertexY).then(function(t){t.data.points&&!function(){var n=t.data.points[0].split(",");if("Point"===e.vertexEditorGeomType){var o=[n[0],n[1]];e.vertexEditorFeature.getGeometry().setCoordinates(o)}else{var a=e.vertexEditorFeature.getGeometry().getCoordinates();"Polygon"===e.vertexEditorGeomType&&(a=a[0]);var r=a.map(function(t,o){return o===e.vertexIndex&&(t[0]=parseInt(n[0]),t[1]=parseInt(n[1])),t});"Polygon"===e.vertexEditorGeomType&&(r=[r]),e.vertexEditorFeature.getGeometry().setCoordinates(r)}e.showVertexEditor=!1,GV.app.map.getLayerByName("InfoWmsHilite").getSource().clear()}()})},cancelVertexEditor:function(){this.vertexX=0,this.vertexY=0,this.showVertexEditor=!1,GV.app.map.getLayerByName("InfoWmsHilite").getSource().clear()},setVertexIndex:function(e){var t=this.vertexEditorFeature.getGeometry().getCoordinates();"Polygon"===this.vertexEditorGeomType&&(t=t[0]),this.vertexIndex=-1;for(var n=0;n<t.length;n++)t[n][0]===e[0]&t[n][1]===e[1]&&(this.vertexIndex=n)},setModifyCondition:function(){var e=this,t=null;return this.options.vertexEditor&&(t=function(t){var n=GV.app.map.map.getFeaturesAtPixel(t.pixel,{hitTolerance:5});return n&&!function(){e.vertexEditorFeature=n[0].getProperties("features").features[0],e.vertexEditorGeomType=e.vertexEditorFeature.getGeometry().getType();var t=n[0].getGeometry().flatCoordinates;e.setVertexIndex(t);var o="3857",a=e.options.epsg;(0,k.default)(o,a,parseInt(t[0]),parseInt(t[1])).then(function(n){if(n.data.points){var o=n.data.points[0].split(",");e.vertexX=parseInt(o[0]),e.vertexY=parseInt(o[1]),e.showVertexEditor=!0;var a=[{type:"Feature",geometry:{type:"Point",coordinates:ol.proj.transform(t,"EPSG:3857","EPSG:4326")}}];GV.app.map.hiliteFeatures(a)}})}(),!0}),t},addInteractionModify:function(){this.interaction=new ol.interaction.Modify({source:this.layer.getSource(),condition:this.setModifyCondition()}),GV.app.map.addInteraction(this.interaction),this.setSnapInteraction()},addInteractionDelete:function(){var e=this;this.interaction=new ol.interaction.Select({source:this.layer.getSource()}),GV.app.map.addInteraction(this.interaction),this.setSnapInteraction(),this.interaction.on("select",function(t){var n=t.target.getFeatures().getArray()[0];e.layer.getSource().removeFeature(n),e.deletedItems.push(n)})},addInteractionDraw:function(e){var t=this;this.interaction=new ol.interaction.Draw({source:this.layer.getSource(),type:e,style:this.style}),GV.app.map.addInteraction(this.interaction),this.setSnapInteraction(),this.interaction.on("drawstart",function(e){}),this.interaction.on("drawend",function(e){e.feature;if(!t.options.multiGeom){var n=!0,o=!1,a=void 0;try{for(var r,i=(0,v.default)(t.layer.getSource().getFeatures());!(n=(r=i.next()).done);n=!0){var s=r.value;t.layer.getSource().removeFeature(s)}}catch(e){o=!0,a=e}finally{try{!n&&i.return&&i.return()}finally{if(o)throw a}}}})},addLayerFeatures:function(e,t){var n=this;this.layer.getSource().clear(!0),console.log("Sono in addLayerFeatures",e);var o=this.layer.getSource();if("wfs"!==t){if("geojson"===t)return"string"==typeof e&&(e=JSON.parse(e)),void this.addFeatures(e.features,o);if("wkt"!==t);else{var a=!0,r=!1,i=void 0;try{for(var s,l=(0,v.default)(e);!(a=(s=l.next()).done);a=!0){var c=s.value,d=new ol.format.WKT({}),u=d.readFeature(c,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"});o.addFeature(u)}}catch(e){r=!0,i=e}finally{try{!a&&l.return&&l.return()}finally{if(r)throw i}}}}else{var p=!0,f=!1,g=void 0;try{for(var m,h=(0,v.default)(e);!(p=(m=h.next()).done);p=!0){var w=m.value;(0,_.default)(null,null,w.wfsURL).then(function(e){n.addFeatures(e,o)}).catch(function(e){console.error(e)})}}catch(e){f=!0,g=e}finally{try{!p&&h.return&&h.return()}finally{if(f)throw g}}}},addFeatures:function(e,t){if(e&&e.length>0){var n=!0,o=!1,a=void 0;try{for(var r,i=(0,v.default)(e);!(n=(r=i.next()).done);n=!0){var s=r.value;if(s.geometry){var l=(new ol.format.GeoJSON).readFeature(s,{featureProjection:"EPSG:3857"});t.addFeature(l)}}}catch(e){o=!0,a=e}finally{try{!n&&i.return&&i.return()}finally{if(o)throw a}}GV.app.map.fit(t.getExtent(),{maxZoom:17})}},clear:function(){GV.app.map.getOverlays().clear(),GV.app.map.removeInteraction(this.interaction),GV.app.map.removeInteraction(this.snapInteraction),this.setButtonClass(null)},cancel:function(){this.options.cancel&&this.options.cancel()},confirmRefresh:function(){var e=confirm("L'operazione cancella eventuali modifiche non salvate su DB.\n\nSei sicuro?");1==e&&this.refresh()},refresh:function(){this.layer.getSource().clear(),this.deletedItems=[],this.options.initWfsRequests&&this.addLayerFeatures(this.options.initWfsRequests,"wfs"),this.options.geoJson&&this.addLayerFeatures(this.options.geoJson,"geojson"),this.options.WKT&&this.addLayerFeatures(this.options.WKT,"wkt"),this.refreshWMS()},refreshWMS:function(){var e=[];Array.isArray(this.idLayer)?this.idLayer.forEach(function(t){e.push(t)}):e.push(this.idLayer),e.forEach(function(e){var t=GV.app.map.getLayerByName(e);if(t){var n=t.getSource().getParams();t.getSource().updateParams(n)}})},confirmSubmit:function(){var e=this;return(0,p.default)(d.default.mark(function t(){var n;return d.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.options.noConfirm?e.submit():(n=confirm("Sei sicuro?"),1==n&&e.submit());case 1:case"end":return t.stop()}},t,e)}))()},submit:function(){var e=this;return(0,p.default)(d.default.mark(function t(){var n,o,a,i;return d.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.loading=l.default.service({text:"Salvataggio...",background:"rgba(0, 0, 0, 0.8)"}),n=(new ol.format.GeoJSON).writeFeaturesObject(e.layer.getSource().getFeatures()),!e.options.coord3d){t.next=6;break}return t.next=5,e.setElevation(n.features);case 5:n.features=t.sent;case 6:if(!e.options.epsgOut||"3857"===e.options.epsgOut){t.next=14;break}return t.next=9,fetch("/geoservices/REST/coordinate/transform_geojson",{method:"POST",headers:{"Content-Type":"application/json"},body:(0,r.default)({geoJSON:n,srsIn:"3857",srsOut:e.options.epsgOut})});case 9:return o=t.sent,t.next=12,o.json();case 12:a=t.sent,n=a.geoJSON;case 14:e.options.formatOut&&"WKT"===e.options.formatOut&&!function(){var t=e.options.epsgOut&&"3857"!==e.options.epsgOut?"EPSG:"+e.options.epsgOut:"EPSG:3857",o=[];n.features.forEach(function(e){var n=(new ol.format.GeoJSON).readFeature(e,{featureProjection:t}),a=new ol.format.WKT({}),r=a.writeFeature(n);o.push(r)}),n={wkt_geom_list:o}}(),i=(new ol.format.GeoJSON).writeFeaturesObject(e.deletedItems),e.options.submit(n,i,e.loading,e.refresh);case 17:case"end":return t.stop()}},t,e)}))()},setElevation:function(e){var t=this;return(0,p.default)(d.default.mark(function n(){var o,a;return d.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:o=d.default.mark(function n(){var o,r,i,s;return d.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return o=e[a],r=void 0,"Point"===o.geometry.type?r=o.geometry.coordinates[0]+","+o.geometry.coordinates[1]:(i=o.geometry.coordinates.map(function(e){return e[0]+","+e[1]}),r=i.join("|")),t.next=5,F.default.get("https://srvcarto.regione.liguria.it/geoservices/REST/coordinate/elevation/3857/"+r);case 5:s=t.sent,s.data&&s.data.status&&"OK"===s.data.status&&("Point"===o.geometry.type?o.geometry.coordinates[2]?o.geometry.coordinates[2]=s.data.elevation[0]:o.geometry.coordinates.push(s.data.elevation[0]):!function(){var e=0;o.geometry.coordinates.forEach(function(t){t[2]?t[2]=s.data.elevation[e]:t.push(s.data.elevation[e]),e++})}());case 7:case"end":return t.stop()}},n,t)}),a=0;case 2:if(!(a<e.length)){n.next=7;break}return n.delegateYield(o(),"t0",4);case 4:a++,n.next=2;break;case 7:return n.abrupt("return",e);case 8:case"end":return n.stop()}},n,t)}))()}},created:function(){GV.app.tools.draw=this},mounted:function(){var e=this;GV.eventBus.$on("gv-control-draw-activate",function(t){e.layer.setVisible(!0)}),GV.eventBus.$on("gv-control-draw-deactivate",function(t){e.clear(),e.layer.setVisible(!1)}),this.layer=new ol.layer.Vector({source:new ol.source.Vector,style:this.style,zIndex:800}),GV.app.map.addLayer(this.layer),this.options.initWfsRequests&&this.addLayerFeatures(this.options.initWfsRequests,"wfs"),this.options.geoJson&&this.addLayerFeatures(this.options.geoJson,"geojson"),this.options.wkt&&this.addLayerFeatures(this.options.wkt,"wkt"),GV.app.map.clearLayer("InfoWmsHilite")}}},523:function(e,t,n){t=e.exports=n(3)(),t.push([e.id,".gv-draw-panel{position:absolute;width:260px;left:0;top:0;margin-left:10px;margin-top:50px;z-index:800}.gv-draw-vertex-editor{padding-top:10px;border:1px solid #fff}.gv-draw-panel-body{padding:10px;overflow-y:auto;width:240px}.gv-draw-panel-result{position:absolute;padding-left:3px;margin:0;width:230px}.gv-draw-buttons{width:20px;float:left;margin:4px}.gv-draw-buttons-reset{width:36px;padding-left:2px}#gv-draw-modify{margin-left:25px}#gv-draw-delete,#gv-draw-modify{padding-top:5.8px}.el-row{padding:5px 5px 5px 10px}","",{version:3,sources:["/./src/components/DrawOL.vue"],names:[],mappings:"AACA,eACE,kBAAmB,AACnB,YAAa,AACb,OAAU,AACV,MAAS,AACT,iBAAkB,AAClB,gBAAiB,AACjB,WAAa,CACd,AACD,uBACE,iBAAkB,AAClB,qBAAwB,CACzB,AACD,oBACE,aAAc,AACd,gBAAiB,AACjB,WAAa,CAEd,AACD,sBACE,kBAAmB,AACnB,iBAAkB,AAClB,SAAY,AACZ,WAAa,CACd,AACD,iBACE,WAAY,AACZ,WAAY,AACZ,UAAY,CACb,AACD,uBACE,WAAY,AACZ,gBAAkB,CACnB,AACD,gBACE,gBAAkB,CAEnB,AACD,gCAFE,iBAAmB,CAIpB,AACD,QACE,wBAA0B,CAC3B",file:"DrawOL.vue",sourcesContent:["\n.gv-draw-panel {\r\n  position: absolute;\r\n  width: 260px;\r\n  left: 0px;\r\n  top: 0px;\r\n  margin-left: 10px;\r\n  margin-top: 50px;\r\n  z-index: 800;\n}\n.gv-draw-vertex-editor {\r\n  padding-top: 10px;\r\n  border: 1px solid white;\n}\n.gv-draw-panel-body {\r\n  padding: 10px;\r\n  overflow-y: auto;\r\n  width: 240px;\r\n  /* height: 25px; */\n}\n.gv-draw-panel-result {\r\n  position: absolute;\r\n  padding-left: 3px;\r\n  margin: 0px;\r\n  width: 230px;\n}\n.gv-draw-buttons {\r\n  width: 20px;\r\n  float: left;\r\n  margin: 4px;\n}\n.gv-draw-buttons-reset {\r\n  width: 36px;\r\n  padding-left: 2px;\n}\n#gv-draw-modify {\r\n  margin-left: 25px;\r\n  padding-top: 5.8px;\n}\n#gv-draw-delete {\r\n  padding-top: 5.8px;\n}\n.el-row {\r\n  padding: 5px 5px 5px 10px;\n}\r\n"],sourceRoot:"webpack://"}])},666:function(e,t,n){var o=n(523);"string"==typeof o&&(o=[[e.id,o,""]]);n(4)(o,{});o.locals&&(e.exports=o.locals)},736:function(e,t,n){var o,a;n(666),o=n(269);var r=n(905);a=o=o||{},"object"!=typeof o.default&&"function"!=typeof o.default||(a=o=o.default),"function"==typeof a&&(a=a.options),a.render=r.render,a.staticRenderFns=r.staticRenderFns,e.exports=o},905:function(e,t){e.exports={render:function(){var e=this;e.$createElement;return e._c("div",{staticClass:"gv-draw-panel",attrs:{id:"gv-draw-panel"}},[e._c("gv-title",{directives:[{name:"draggable",rawName:"v-draggable"}],attrs:{title:e.title,divId:"gv-draw-panel",noClose:!0}}),e._v(" "),e._c("div",{staticClass:"gv-draw-panel-body gv-inverted-color-scheme",attrs:{id:"gv-draw-panel-body"}},[e._c("el-button",{directives:[{name:"show",rawName:"v-show",value:e.pointButton,expression:"pointButton"}],staticClass:"gv-color-scheme fg-point",attrs:{id:"gv-draw-Point",title:"Disegna punto",size:"mini"},on:{click:function(t){e.draw("Point")}}}),e._v(" "),e._c("el-button",{directives:[{name:"show",rawName:"v-show",value:e.lineButton,expression:"lineButton"}],staticClass:"gv-color-scheme fg-polyline-pt",attrs:{id:"gv-draw-LineString",title:"Disegna linea",size:"mini"},on:{click:function(t){e.draw("LineString")}}}),e._v(" "),e._c("el-button",{directives:[{name:"show",rawName:"v-show",value:e.polygonButton,expression:"polygonButton"}],staticClass:"gv-color-scheme fg-polygon-pt",attrs:{id:"gv-draw-Polygon",title:"Disegna poligono",size:"mini"},on:{click:function(t){e.draw("Polygon")}}}),e._v(" "),e._c("el-button",{directives:[{name:"show",rawName:"v-show",value:e.modifyButton,expression:"modifyButton"}],staticClass:"gv-color-scheme fa fa-edit",attrs:{id:"gv-draw-modify",title:"Modifica",size:"mini"},on:{click:function(t){e.draw("modify")}}}),e._v(" "),e._c("el-button",{directives:[{name:"show",rawName:"v-show",value:e.deleteButton,expression:"deleteButton"}],staticClass:"gv-color-scheme el-icon-delete",attrs:{id:"gv-draw-delete",title:"Cancella",size:"mini"},on:{click:function(t){e.draw("delete")}}})],1),e._v(" "),e._c("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"left"}},[e._c("el-checkbox",{on:{change:e.setSnapInteraction},model:{value:e.snap,callback:function(t){e.snap=t},expression:"snap"}},[e._v("Snap")])],1),e._v(" "),e._c("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"left"}},[e._c("el-button",{staticClass:"gv-color-scheme",attrs:{id:"gv-draw-submit",title:"Salva i dati sul DB",size:"mini"},on:{click:e.confirmSubmit}},[e._v("Salva")]),e._v(" "),e._c("el-button",{directives:[{name:"show",rawName:"v-show",value:e.cancelButton,expression:"cancelButton"}],staticClass:"gv-color-scheme",attrs:{id:"gv-draw-cancel",title:"Ritorno alla applicazione",size:"mini"},on:{click:e.cancel}},[e._v("Annulla")]),e._v(" "),e._c("el-button",{directives:[{name:"show",rawName:"v-show",value:e.refreshButton,expression:"refreshButton"}],staticClass:"gv-color-scheme",attrs:{id:"gv-draw-cancel",title:"Ricarica dati salvati sul DB",size:"mini"},on:{click:e.confirmRefresh}},[e._v("Ricarica")])],1),e._v(" "),e.showVertexEditor?e._c("div",{staticClass:"gv-draw-vertex-editor gv-inverted-color-scheme"},[e._c("el-row",[e._c("b",[e._v("EDITOR VERTICI")])]),e._v(" "),e._c("el-row",[e._v("\n      X:\n      "),e._c("el-input",{staticStyle:{width:"80px"},attrs:{size:"mini",placeholder:"X"},model:{value:e.vertexX,callback:function(t){e.vertexX=t},expression:"vertexX"}}),e._v(" Y:\n      "),e._c("el-input",{staticStyle:{width:"80px"},attrs:{size:"mini",placeholder:"Y"},model:{value:e.vertexY,callback:function(t){e.vertexY=t},expression:"vertexY"}})],1),e._v(" "),e._c("el-row",[e._c("el-button",{staticClass:"gv-color-scheme",attrs:{id:"gv-draw-vertex-editor-submit",title:"Modifica Vertice",size:"mini"},on:{click:e.submitVertexEditor}},[e._v("Modifica")]),e._v(" "),e._c("el-button",{staticClass:"gv-color-scheme",attrs:{id:"gv-draw-vertex-editor-cancel",title:"Annulla Modifica Vertice",size:"mini"},on:{click:e.cancelVertexEditor}},[e._v("Annulla")])],1)],1):e._e()],1)},staticRenderFns:[]}}});
//# sourceMappingURL=36.js.map