webpackJsonp([21,33],{242:function(t,e,o){"use strict";function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var n=o(28),s=(a(n),o(27)),i=a(s),r=o(53),l=a(r),d=o(83),p=(a(d),o(76)),u=a(p),c=o(65),h=(a(c),o(64)),f=a(h),m=o(42),g=(a(m),o(39)),A=a(g),w=o(9),v=(a(w),o(5)),C=(a(v),o(8)),y=a(C),b=o(1),B=a(b),x=o(50),_=a(x),E=o(337),I=a(E),k=o(35),D=a(k);B.default.use(y.default),B.default.use(A.default),B.default.use(f.default),e.default={name:"gv-draw-panel",data:function(){var t=GV.config.getToolOptions("gv-draw-button");return{options:t,title:"Acquisizione Geometrie",defaultColor:"#3388ff",results:[],requestCount:0,numRequests:0,drawnItems:null,editing:!1,deletedItems:[],submitButton:t.buttons&&t.buttons.submit,cancelButton:t.buttons&&t.buttons.cancel,refreshButton:t.buttons&&t.buttons.refresh}},computed:{},methods:{cancel:function(){this.options.cancel&&this.options.cancel(this.results)},refresh:function(){var t=confirm("L'operazione cancella eventuali modifiche non salvate su DB.\n\nSei sicuro?");1==t&&(this.results=[],this.deletedItems=[],this.options.initWfsRequests&&this.addLayerFeatures(this.options.initWfsRequests))},submit:function(){var t=confirm("Sei sicuro?");1==t&&this.submitOK()},submitOK:function(){var t=this;return this.editing?void(0,u.default)({title:"Attenzione",type:"warning",duration:5e3,offset:70,dangerouslyUseHTMLString:!0,position:"bottom-left",message:"Modifiche in corso, salva o annulla le modifiche prima di inviare i dati"}):(this.requestCount=0,this.results=(0,l.default)(this.drawnItems._layers).map(function(e){return{type:t.drawnItems._layers[e].options.type,properties:t.drawnItems._layers[e].options.properties,id:t.drawnItems._layers[e].options.id,layerName:t.drawnItems._layers[e].options.layerName,latlngs:"point"===t.drawnItems._layers[e].options.type?t.drawnItems._layers[e]._latlng:t.drawnItems._layers[e]._latlngs}}),this.numRequests=this.results.length,0===this.results.length&&0===this.deletedItems.length?void(0,u.default)({title:"Attenzione",type:"warning",duration:5e3,offset:70,position:"bottom-left",message:"Nessuna geometria da salvare, insersci le geometrie oppure premi il tasto 'Annulla'"}):(this.loading=i.default.service({text:"Salvataggio...",background:"rgba(0, 0, 0, 0.8)"}),void(0===this.results.length?this.options.submit(this.results,this.deletedItems,this.loading):this.results.forEach(function(e){t.convertCoords(e)}))))},submitRefresh:function(){this.results=[],this.deletedItems=[],this.options.initWfsRequests&&this.addLayerFeatures(this.options.initWfsRequests)},checkEndRequests:function(){this.requestCount===this.numRequests&&this.options.submit(this.results,this.deletedItems,this.loading,this.submitRefresh)},convertCoords:function(t){switch(t.type){case"point":this.convertCoordsPoint(t);break;case"polyline":this.convertCoordsLine(t);break;case"polygon":this.convertCoordsPolygon(t)}},convertCoordsPoint:function(t){var e=this;"4326"===this.options.epsg?(this.requestCount++,t.geom=[t.latlngs.lng.toFixed(6),t.latlngs.lat.toFixed(6)],this.checkEndRequests()):(0,_.default)("4326",this.options.epsg,t.latlngs.lng,t.latlngs.lat).then(function(o){e.requestCount++,o.data.points&&(t.geom=o.data.points[0].split(",")),e.checkEndRequests()})},convertCoordsLine:function(t){var e=this,o=[];if(t.latlngs.forEach(function(t){o.push([t.lng,t.lat])}),"4326"===this.options.epsg)this.requestCount++,t.geom=o,this.checkEndRequests();else{var a={srsIn:"4326",srsOut:this.options.epsg,poly:o};(0,I.default)(a).then(function(o){e.requestCount++,t.geom=o.poly,e.checkEndRequests()})}},convertCoordsPolygon:function(t){var e=this,o=[];if(t.latlngs.forEach(function(t){t.forEach(function(t){o.push([t.lng,t.lat])})}),"4326"===this.options.epsg)this.requestCount++,t.geom=o,this.checkEndRequests();else{var a={srsIn:"4326",srsOut:this.options.epsg,poly:o};(0,I.default)(a).then(function(o){e.requestCount++,t.geom=o.poly,e.checkEndRequests()})}},setEditOptions:function(){var t=null;return this.options.tools.edit&&(this.options.tools.edit.edit||this.options.tools.edit.remove)&&(t={featureGroup:this.drawnItems,poly:{allowIntersection:!1}},this.options.tools.edit.remove||(t.remove=!1),this.options.tools.edit.edit||(t.edit=!1),L.EditToolbar.Delete.include({removeAllLayers:!1})),t},setDrawOptions:function(){var t=null;return this.options.tools.draw&&(t={rectangle:!1,marker:!1,circle:!1},this.options.tools.draw.point?t.circlemarker={type:"point",radius:4,color:this.options.color||this.defaultColor}:t.circlemarker=!1,this.options.tools.draw.polyline?t.polyline={shapeOptions:{type:"polyline",color:this.options.color||this.defaultColor}}:t.polyline=!1,this.options.tools.draw.polygon?t.polygon={shapeOptions:{type:"polygon",color:this.options.color||this.defaultColor},allowIntersection:!1}:t.polygon=!1),t},addDrawControl:function(){var t=this.setEditOptions(),e=this.setDrawOptions();this.controlDraw=new L.Control.Draw({draw:e,edit:t}),GV.app.map.addControl(this.controlDraw),this.addDrawToolbar(),this.addEditToolbar()},addDrawToolbar:function(){if(this.options.tools.draw){var t=document.getElementById("gv-draw-panel-draw");t.appendChild(this.controlDraw._toolbars.draw._toolbarContainer),t.appendChild(this.controlDraw._toolbars.draw._actionsContainer),this.options.tools.draw.point&&(document.getElementsByClassName("leaflet-draw-draw-circlemarker")[0].className="gv-draw-buttons ms ms-draw-point"),this.options.tools.draw.polyline&&(document.getElementsByClassName("leaflet-draw-draw-polyline")[0].className="gv-draw-buttons ms ms-draw-line"),this.options.tools.draw.polygon&&(document.getElementsByClassName("leaflet-draw-draw-polygon")[0].className="gv-draw-buttons ms ms-draw-polygon")}},addEditToolbar:function(){if(this.options.tools.edit){var t=document.getElementById("gv-draw-panel-draw");if((this.options.tools.edit.edit||this.options.tools.edit.remove)&&(t.appendChild(this.controlDraw._toolbars.edit._toolbarContainer),t.appendChild(this.controlDraw._toolbars.edit._actionsContainer)),this.options.tools.edit.edit){var e=document.getElementsByClassName("leaflet-draw-edit-edit")[0];e.className="gv-draw-buttons fa fa-edit"}if(this.options.tools.edit.remove){var o=document.getElementsByClassName("leaflet-draw-edit-remove")[0];o.className="gv-draw-buttons fa fa-trash"}}},addLayerFeatures:function(t){var e=this;this.drawnItems.clearLayers(),t.forEach(function(t){(0,D.default)(null,null,t.wfsURL).then(function(o){o.forEach(function(o){e.createGeometry(o,t.layerName)});var a=e.drawnItems.getBounds();a._northEast&&a._southWest&&GV.app.map.fitBounds(e.drawnItems.getBounds(),{maxZoom:17})}).catch(function(t){console.error(t)})})},createGeometry:function(t,e){var o=null;switch(t.geometry.type){case"Point":o=L.circleMarker(L.latLng(t.geometry.coordinates.reverse()),{type:"point",color:this.options.color||this.defaultColor,radius:4,weight:4,opacity:.5,fillOpacity:.5,id:t.id,layerName:e,properties:t.properties}),o&&o.addTo(this.drawnItems);break;case"LineString":var a=this.reverseCoordsLine(t.geometry.coordinates);o=L.polyline(a,{type:"polyline",color:this.options.color||this.defaultColor,id:t.id,layerName:e,properties:t.properties}),o&&o.addTo(this.drawnItems);break;case"MultiLineString":console.warn("ATTENZIONE: geometria di tipo MultiLineString",t);break;case"Polygon":var n=this.reverseCoordsPoly(t.geometry.coordinates);o=L.polygon(n,{type:"polygon",color:this.options.color||this.defaultColor,id:t.id,layerName:e,properties:t.properties}),o&&o.addTo(this.drawnItems);break;case"MultiPolygon":console.warn("ATTENZIONE: geometria di tipo MultiPolygon",t)}},reverseCoordsLine:function(t){var e=[];return t.forEach(function(t){var o=t.reverse();e.push(o)}),e},reverseCoordsPoly:function(t){var e=[];return t.forEach(function(t){var o=t.map(function(t){return[t[1],t[0]]});e.push(o)}),e},hideLayer:function(){this.drawnItems.eachLayer(function(t){t.getElement().style.display="none"})},showLayer:function(){this.drawnItems.eachLayer(function(t){t.getElement().style.display="block"})}},mounted:function(){var t=this;GV.app.map.on("draw:created",function(e){e.layer.addTo(t.drawnItems)}),GV.eventBus.$on("gv-control-draw-deactivate",function(e){GV.app.map.off("draw:created"),t.hideLayer()}),GV.eventBus.$on("gv-control-draw-activate",function(e){GV.app.map.on("draw:created",function(e){e.layer.addTo(t.drawnItems)}),t.showLayer(),t.submitRefresh()}),GV.app.map.on("draw:editstart",function(e){t.editing=!0}),GV.app.map.on("draw:editstop",function(e){t.editing=!1}),GV.app.map.on("draw:deletestart",function(e){t.editing=!0}),GV.app.map.on("draw:deletestop",function(e){t.editing=!1}),GV.app.map.on("draw:drawstart",function(e){t.editing=!0}),GV.app.map.on("draw:drawstop",function(e){t.editing=!1}),GV.app.map.on("draw:deleted",function(e){(0,l.default)(e.layers._layers).forEach(function(o){var a={type:e.layers._layers[o].options.type,properties:e.layers._layers[o].options.properties,id:e.layers._layers[o].options.id,layerName:e.layers._layers[o].options.layerName,latlngs:"point"===e.layers._layers[o].options.type?e.layers._layers[o]._latlng:e.layers._layers[o]._latlngs};t.deletedItems.push(a)})}),this.drawnItems=L.featureGroup(),this.drawnItems.addTo(GV.app.map),this.options.initWfsRequests&&this.addLayerFeatures(this.options.initWfsRequests),this.addDrawControl(),GV.app.map.getLayerByName("InfoWmsHilite").clearLayers()}}},337:function(t,e,o){"use strict";function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return s.default.post(r.default.RL_TRANSFORM_POLY_SERVICE,{headers:{Accept:"text/xml"},data:t}).then(function(t){return t.data})};var n=o(4),s=a(n),i=o(6),r=a(i)},470:function(t,e,o){e=t.exports=o(2)(),e.push([t.id,".gv-draw-panel{position:absolute;width:260px;left:0;top:0;margin-left:10px;margin-top:50px;z-index:800}.gv-draw-panel-body{padding:10px;overflow-y:auto;width:240px;height:80px}.gv-draw-panel-result{position:absolute;padding-left:3px;margin:0;width:230px}.gv-draw-buttons{width:20px;float:left;margin:4px}.gv-draw-buttons-reset{width:36px;padding-left:2px}.leaflet-bar{box-shadow:none}.leaflet-draw-actions{left:2px;top:54px!important}.leaflet-draw-actions a{padding:7px;margin:2px}.leaflet-draw-actions li:last-child a{border-radius:0 0 0 0}.leaflet-draw-actions li:first-child a{margin-left:4px}.leaflet-draw-toolbar a{background-image:none}.leaflet-draw-toolbar .leaflet-draw-draw-polyline{background-position:-2px -2px}.leaflet-bar a:first-child{border-top-left-radius:0;border-top-right-radius:0}.leaflet-bar a:last-child{border-bottom-left-radius:0;border-bottom-right-radius:0;margin-right:20px}","",{version:3,sources:["/./src/components/Draw.vue"],names:[],mappings:"AACA,eACE,kBAAmB,AACnB,YAAa,AACb,OAAU,AACV,MAAS,AACT,iBAAkB,AAClB,gBAAiB,AACjB,WAAa,CACd,AACD,oBACE,aAAc,AACd,gBAAiB,AACjB,YAAa,AACb,WAAa,CACd,AACD,sBACE,kBAAmB,AACnB,iBAAkB,AAClB,SAAY,AACZ,WAAa,CACd,AACD,iBACE,WAAY,AACZ,WAAY,AACZ,UAAY,CACb,AACD,uBACE,WAAY,AACZ,gBAAkB,CACnB,AACD,aACE,eAAiB,CAClB,AACD,sBACE,SAAU,AACV,kBAAqB,CACtB,AACD,wBACE,YAAa,AACb,UAAY,CACb,AACD,sCACE,qBAAuB,CACxB,AACD,uCACE,eAAiB,CAClB,AACD,wBACE,qBAAuB,CACxB,AACD,kDACE,6BAA+B,CAChC,AACD,2BACE,yBAA4B,AAC5B,yBAA6B,CAC9B,AACD,0BACE,4BAA+B,AAC/B,6BAAgC,AAChC,iBAAmB,CACpB",file:"Draw.vue",sourcesContent:["\n.gv-draw-panel {\r\n  position: absolute;\r\n  width: 260px;\r\n  left: 0px;\r\n  top: 0px;\r\n  margin-left: 10px;\r\n  margin-top: 50px;\r\n  z-index: 800;\n}\n.gv-draw-panel-body {\r\n  padding: 10px;\r\n  overflow-y: auto;\r\n  width: 240px;\r\n  height: 80px;\n}\n.gv-draw-panel-result {\r\n  position: absolute;\r\n  padding-left: 3px;\r\n  margin: 0px;\r\n  width: 230px;\n}\n.gv-draw-buttons {\r\n  width: 20px;\r\n  float: left;\r\n  margin: 4px;\n}\n.gv-draw-buttons-reset {\r\n  width: 36px;\r\n  padding-left: 2px;\n}\n.leaflet-bar {\r\n  box-shadow: none;\n}\n.leaflet-draw-actions {\r\n  left: 2px;\r\n  top: 54px !important;\n}\n.leaflet-draw-actions a {\r\n  padding: 7px;\r\n  margin: 2px;\n}\n.leaflet-draw-actions li:last-child a {\r\n  border-radius: 0 0 0 0;\n}\n.leaflet-draw-actions li:first-child a {\r\n  margin-left: 4px;\n}\n.leaflet-draw-toolbar a {\r\n  background-image: none;\n}\n.leaflet-draw-toolbar .leaflet-draw-draw-polyline {\r\n  background-position: -2px -2px;\n}\n.leaflet-bar a:first-child {\r\n  border-top-left-radius: 0px;\r\n  border-top-right-radius: 0px;\n}\n.leaflet-bar a:last-child {\r\n  border-bottom-left-radius: 0px;\r\n  border-bottom-right-radius: 0px;\r\n  margin-right: 20px;\n}\r\n"],sourceRoot:"webpack://"}])},585:function(t,e,o){var a=o(470);"string"==typeof a&&(a=[[t.id,a,""]]);o(3)(a,{});a.locals&&(t.exports=a.locals)},648:function(t,e,o){var a,n;o(585),a=o(242);var s=o(781);n=a=a||{},"object"!=typeof a.default&&"function"!=typeof a.default||(n=a=a.default),"function"==typeof n&&(n=n.options),n.render=s.render,n.staticRenderFns=s.staticRenderFns,t.exports=a},781:function(t,e){t.exports={render:function(){var t=this;t.$createElement;return t._c("div",{staticClass:"gv-draw-panel",attrs:{id:"gv-draw-panel"}},[t._c("gv-title",{directives:[{name:"draggable",rawName:"v-draggable"}],attrs:{title:t.title,divId:"gv-draw-panel",noClose:!0}}),t._v(" "),t._m(0),t._v(" "),t._c("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"left"}},[t._c("el-button",{staticClass:"gv-color-scheme",attrs:{id:"gv-draw-submit",title:"Salva i dati sul DB",size:"mini"},on:{click:t.submit}},[t._v("Salva su DB")]),t._v(" "),t._c("el-button",{directives:[{name:"show",rawName:"v-show",value:t.cancelButton,expression:"cancelButton"}],staticClass:"gv-color-scheme",attrs:{id:"gv-draw-cancel",title:"Ritorno alla applicazione",size:"mini"},on:{click:t.cancel}},[t._v("Annulla")]),t._v(" "),t._c("el-button",{directives:[{name:"show",rawName:"v-show",value:t.refreshButton,expression:"refreshButton"}],staticClass:"gv-color-scheme",attrs:{id:"gv-draw-cancel",title:"Ricarica dati salvati sul DB",size:"mini"},on:{click:t.refresh}},[t._v("Ricarica")])],1)],1)},staticRenderFns:[function(){var t=this;t.$createElement;return t._c("div",{staticClass:"gv-draw-panel-body gv-inverted-color-scheme",attrs:{id:"gv-draw-panel-body"}},[t._c("div",{staticClass:"gv-draw-panel-result gv-inverted-color-scheme"},[t._c("div",{attrs:{id:"gv-draw-panel-draw"}})])])}]}}});
//# sourceMappingURL=21.js.map