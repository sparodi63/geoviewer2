webpackJsonp([34,36],{257:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(30),a=(o(i),n(29)),r=o(a),s=n(32),l=o(s),c=n(67),d=(o(c),n(65)),u=o(d),p=n(44),v=(o(p),n(40)),g=o(v),f=n(9),m=(o(f),n(5)),h=(o(m),n(8)),w=o(h),y=n(1),x=o(y),A=n(38),C=o(A),b=n(46),B=o(b);x.default.use(w.default),x.default.use(g.default),x.default.use(u.default),t.default={name:"gv-draw-panel",data:function(){var e=GV.config.getToolOptions("gv-draw-button");return{options:e,title:"Acquisizione Geometrie",pointClass:"el-button--default el-button--mini el-button gv-color-scheme ms fg-point",lineClass:"el-button--default el-button--mini el-button gv-color-scheme ms fg-polyline-pt",areaClass:"el-button--default el-button--mini el-button gv-color-scheme ms fg-polygon-pt",modifyClass:"el-button--default el-button--mini el-button gv-color-scheme fa fa-edit",deleteClass:"el-button--default el-button--mini el-button gv-color-scheme el-icon-delete",style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#ffcc33"})})}),type:null,layer:null,interaction:null,snap:!0,snapInteraction:!0,deletedItems:[],idLayer:e.idLayer,submitButton:e.buttons&&e.buttons.submit,cancelButton:e.buttons&&e.buttons.cancel,refreshButton:e.buttons&&e.buttons.refresh,pointButton:e.tools&&e.tools.draw&&e.tools.draw.point,lineButton:e.tools&&e.tools.draw&&e.tools.draw.polyline,polygonButton:e.tools&&e.tools.draw&&e.tools.draw.polygon,modifyButton:e.tools&&e.tools.edit&&e.tools.edit.edit,deleteButton:e.tools&&e.tools.edit&&e.tools.edit.remove,vertexEditorFeature:null,vertexEditorGeomType:null,showVertexEditor:!1,vertexIndex:-1,vertexX:0,vertexY:0,vertexMarker:null}},computed:{},methods:{setButtonClass:function(e){document.getElementById("gv-draw-Point").className=this.pointClass,document.getElementById("gv-draw-LineString").className=this.lineClass,document.getElementById("gv-draw-Polygon").className=this.areaClass,document.getElementById("gv-draw-modify").className=this.modifyClass,document.getElementById("gv-draw-delete").className=this.deleteClass,e&&(document.getElementById("gv-draw-"+e).className+=" gv-button-selected")},draw:function(e){switch(this.type=e,this.setButtonClass(null),this.setButtonClass(e),GV.app.map.getOverlays().clear(),this.interaction&&GV.app.map.removeInteraction(this.interaction),e){case"modify":this.addInteractionModify();break;case"delete":this.addInteractionDelete();break;default:this.addInteractionDraw(e)}},pointerMoveHandler:function(e){if(!e.dragging){var t="Click per disegnare";if(this.sketch){var n=this.sketch.getGeometry();n instanceof ol.geom.Polygon?t=this.continuePolygonMsg:n instanceof ol.geom.LineString&&(t=this.continueLineMsg)}this.helpTooltipElement.innerHTML=t,this.helpTooltip.setPosition(e.coordinate),this.helpTooltipElement.classList.remove("hidden")}},setSnapInteraction:function(){this.snap?(this.snapInteraction=new ol.interaction.Snap({source:this.layer.getSource()}),GV.app.map.addInteraction(this.snapInteraction)):GV.app.map.removeInteraction(this.snapInteraction)},submitVertexEditor:function(){var e=this;(0,B.default)(this.options.epsg,"3857",this.vertexX,this.vertexY).then(function(t){t.data.points&&!function(){var n=t.data.points[0].split(",");if("Point"===e.vertexEditorGeomType){var o=[n[0],n[1]];e.vertexEditorFeature.getGeometry().setCoordinates(o)}else{var i=e.vertexEditorFeature.getGeometry().getCoordinates();"Polygon"===e.vertexEditorGeomType&&(i=i[0]);var a=i.map(function(t,o){return o===e.vertexIndex&&(t[0]=parseInt(n[0]),t[1]=parseInt(n[1])),t});"Polygon"===e.vertexEditorGeomType&&(a=[a]),e.vertexEditorFeature.getGeometry().setCoordinates(a)}e.showVertexEditor=!1,GV.app.map.getLayerByName("InfoWmsHilite").getSource().clear()}()})},cancelVertexEditor:function(){this.vertexX=0,this.vertexY=0,this.showVertexEditor=!1,GV.app.map.getLayerByName("InfoWmsHilite").getSource().clear()},setVertexIndex:function(e){var t=this.vertexEditorFeature.getGeometry().getCoordinates();"Polygon"===this.vertexEditorGeomType&&(t=t[0]),this.vertexIndex=-1;for(var n=0;n<t.length;n++)t[n][0]===e[0]&t[n][1]===e[1]&&(this.vertexIndex=n)},setModifyCondition:function(){var e=this,t=null;return this.options.vertexEditor&&(t=function(t){var n=GV.app.map.map.getFeaturesAtPixel(t.pixel,{hitTolerance:5});return n&&!function(){e.vertexEditorFeature=n[0].getProperties("features").features[0],e.vertexEditorGeomType=e.vertexEditorFeature.getGeometry().getType();var t=n[0].getGeometry().flatCoordinates;e.setVertexIndex(t);var o="3857",i=e.options.epsg;(0,B.default)(o,i,parseInt(t[0]),parseInt(t[1])).then(function(n){if(n.data.points){var o=n.data.points[0].split(",");e.vertexX=parseInt(o[0]),e.vertexY=parseInt(o[1]),e.showVertexEditor=!0;var i=[{type:"Feature",geometry:{type:"Point",coordinates:ol.proj.transform(t,"EPSG:3857","EPSG:4326")}}];GV.app.map.hiliteFeatures(i)}})}(),!0}),t},addInteractionModify:function(){this.interaction=new ol.interaction.Modify({source:this.layer.getSource(),condition:this.setModifyCondition()}),GV.app.map.addInteraction(this.interaction),this.setSnapInteraction()},addInteractionDelete:function(){var e=this;this.interaction=new ol.interaction.Select({source:this.layer.getSource()}),GV.app.map.addInteraction(this.interaction),this.setSnapInteraction(),this.interaction.on("select",function(t){console.log(t.target.getFeatures().getArray());var n=t.target.getFeatures().getArray()[0];e.layer.getSource().removeFeature(n),e.deletedItems.push(n)})},addInteractionDraw:function(e){var t=this;this.interaction=new ol.interaction.Draw({source:this.layer.getSource(),type:e,style:this.style}),GV.app.map.addInteraction(this.interaction),this.setSnapInteraction(),this.interaction.on("drawstart",function(e){console.log("drawstart")}),this.interaction.on("drawend",function(e){var n=e.feature;if(console.log("drawend",n),!t.options.multiGeom){var o=!0,i=!1,a=void 0;try{for(var r,s=(0,l.default)(t.layer.getSource().getFeatures());!(o=(r=s.next()).done);o=!0){var c=r.value;console.log(c),t.layer.getSource().removeFeature(c)}}catch(e){i=!0,a=e}finally{try{!o&&s.return&&s.return()}finally{if(i)throw a}}}console.log("drawend 2",t.layer.getSource().getFeatures())})},addLayerFeatures:function(e){var t=this;this.layer.getSource().clear(!0);var n=!0,o=!1,i=void 0;try{for(var a,r=(0,l.default)(e);!(n=(a=r.next()).done);n=!0){var s=a.value;(0,C.default)(null,null,s.wfsURL).then(function(e){if(e&&e.length>0){var n=t.layer.getSource(),o=!0,i=!1,a=void 0;try{for(var r,s=(0,l.default)(e);!(o=(r=s.next()).done);o=!0){var c=r.value;if(c.geometry){var d=(new ol.format.GeoJSON).readFeature(c,{featureProjection:"EPSG:3857"});n.addFeature(d)}}}catch(e){i=!0,a=e}finally{try{!o&&s.return&&s.return()}finally{if(i)throw a}}GV.app.map.fit(n.getExtent(),{maxZoom:17})}}).catch(function(e){console.error(e)})}}catch(e){o=!0,i=e}finally{try{!n&&r.return&&r.return()}finally{if(o)throw i}}},clear:function(){GV.app.map.getOverlays().clear(),GV.app.map.removeInteraction(this.interaction),GV.app.map.removeInteraction(this.snapInteraction),this.setButtonClass(null)},cancel:function(){this.options.cancel&&this.options.cancel()},confirmRefresh:function(){var e=confirm("L'operazione cancella eventuali modifiche non salvate su DB.\n\nSei sicuro?");1==e&&this.refresh()},refresh:function(){this.layer.getSource().clear(),this.deletedItems=[],this.options.initWfsRequests&&this.addLayerFeatures(this.options.initWfsRequests),this.refreshWMS()},refreshWMS:function(){var e=GV.app.map.getLayerByName(this.idLayer);if(e){var t=e.getSource().getParams();e.getSource().updateParams(t)}},confirmSubmit:function(){var e=confirm("Sei sicuro?");1==e&&this.submit()},submit:function(){this.loading=r.default.service({text:"Salvataggio...",background:"rgba(0, 0, 0, 0.8)"});var e=(new ol.format.GeoJSON).writeFeaturesObject(this.layer.getSource().getFeatures()),t=(new ol.format.GeoJSON).writeFeaturesObject(this.deletedItems);console.log("submit",e,t),this.options.submit(e,t,this.loading,this.refresh)}},mounted:function(){var e=this;GV.eventBus.$on("gv-control-draw-activate",function(t){console.log("gv-control-draw-activate"),e.layer.setVisible(!0)}),GV.eventBus.$on("gv-control-draw-deactivate",function(t){console.log("gv-control-draw-deactivate"),e.clear(),e.layer.setVisible(!1)}),this.layer=new ol.layer.Vector({source:new ol.source.Vector,style:this.style,zIndex:800}),GV.app.map.addLayer(this.layer),this.options.initWfsRequests&&this.addLayerFeatures(this.options.initWfsRequests),GV.app.map.clearLayer("InfoWmsHilite")}}},501:function(e,t,n){t=e.exports=n(2)(),t.push([e.id,".gv-draw-panel{position:absolute;width:260px;left:0;top:0;margin-left:10px;margin-top:50px;z-index:800}.gv-draw-vertex-editor{padding-top:10px;border:1px solid #fff}.gv-draw-panel-body{padding:10px;overflow-y:auto;width:240px}.gv-draw-panel-result{position:absolute;padding-left:3px;margin:0;width:230px}.gv-draw-buttons{width:20px;float:left;margin:4px}.gv-draw-buttons-reset{width:36px;padding-left:2px}#gv-draw-modify{margin-left:25px}#gv-draw-delete,#gv-draw-modify{padding-top:5.8px}.el-row{padding:5px 5px 5px 10px}","",{version:3,sources:["/./src/components/DrawOL.vue"],names:[],mappings:"AACA,eACE,kBAAmB,AACnB,YAAa,AACb,OAAU,AACV,MAAS,AACT,iBAAkB,AAClB,gBAAiB,AACjB,WAAa,CACd,AACD,uBACE,iBAAkB,AAClB,qBAAuB,CACxB,AACD,oBACE,aAAc,AACd,gBAAiB,AACjB,WAAa,CAEd,AACD,sBACE,kBAAmB,AACnB,iBAAkB,AAClB,SAAY,AACZ,WAAa,CACd,AACD,iBACE,WAAY,AACZ,WAAY,AACZ,UAAY,CACb,AACD,uBACE,WAAY,AACZ,gBAAkB,CACnB,AACD,gBACE,gBAAkB,CAEnB,AACD,gCAFE,iBAAmB,CAIpB,AACD,QACE,wBAA0B,CAC3B",file:"DrawOL.vue",sourcesContent:["\n.gv-draw-panel {\r\n  position: absolute;\r\n  width: 260px;\r\n  left: 0px;\r\n  top: 0px;\r\n  margin-left: 10px;\r\n  margin-top: 50px;\r\n  z-index: 800;\n}\n.gv-draw-vertex-editor {\r\n  padding-top: 10px;\r\n  border:1px solid white;\n}\n.gv-draw-panel-body {\r\n  padding: 10px;\r\n  overflow-y: auto;\r\n  width: 240px;\r\n  /* height: 25px; */\n}\n.gv-draw-panel-result {\r\n  position: absolute;\r\n  padding-left: 3px;\r\n  margin: 0px;\r\n  width: 230px;\n}\n.gv-draw-buttons {\r\n  width: 20px;\r\n  float: left;\r\n  margin: 4px;\n}\n.gv-draw-buttons-reset {\r\n  width: 36px;\r\n  padding-left: 2px;\n}\n#gv-draw-modify {\r\n  margin-left: 25px;\r\n  padding-top: 5.8px;\n}\n#gv-draw-delete {\r\n  padding-top: 5.8px;\n}\n.el-row {\r\n  padding: 5px 5px 5px 10px;\n}\r\n"],sourceRoot:"webpack://"}])},635:function(e,t,n){var o=n(501);"string"==typeof o&&(o=[[e.id,o,""]]);n(3)(o,{});o.locals&&(e.exports=o.locals)},692:function(e,t,n){var o,i;n(635),o=n(257);var a=n(847);i=o=o||{},"object"!=typeof o.default&&"function"!=typeof o.default||(i=o=o.default),"function"==typeof i&&(i=i.options),i.render=a.render,i.staticRenderFns=a.staticRenderFns,e.exports=o},847:function(e,t){e.exports={render:function(){var e=this;e.$createElement;return e._c("div",{staticClass:"gv-draw-panel",attrs:{id:"gv-draw-panel"}},[e._c("gv-title",{directives:[{name:"draggable",rawName:"v-draggable"}],attrs:{title:e.title,divId:"gv-draw-panel",noClose:!0}}),e._v(" "),e._c("div",{staticClass:"gv-draw-panel-body gv-inverted-color-scheme",attrs:{id:"gv-draw-panel-body"}},[e._c("el-button",{directives:[{name:"show",rawName:"v-show",value:e.pointButton,expression:"pointButton"}],staticClass:"gv-color-scheme fg-point",attrs:{id:"gv-draw-Point",title:"Disegna punto",size:"mini"},on:{click:function(t){e.draw("Point")}}}),e._v(" "),e._c("el-button",{directives:[{name:"show",rawName:"v-show",value:e.lineButton,expression:"lineButton"}],staticClass:"gv-color-scheme fg-polyline-pt",attrs:{id:"gv-draw-LineString",title:"Disegna linea",size:"mini"},on:{click:function(t){e.draw("LineString")}}}),e._v(" "),e._c("el-button",{directives:[{name:"show",rawName:"v-show",value:e.polygonButton,expression:"polygonButton"}],staticClass:"gv-color-scheme fg-polygon-pt",attrs:{id:"gv-draw-Polygon",title:"Disegna poligono",size:"mini"},on:{click:function(t){e.draw("Polygon")}}}),e._v(" "),e._c("el-button",{directives:[{name:"show",rawName:"v-show",value:e.modifyButton,expression:"modifyButton"}],staticClass:"gv-color-scheme fa fa-edit",attrs:{id:"gv-draw-modify",title:"Modifica",size:"mini"},on:{click:function(t){e.draw("modify")}}}),e._v(" "),e._c("el-button",{directives:[{name:"show",rawName:"v-show",value:e.deleteButton,expression:"deleteButton"}],staticClass:"gv-color-scheme el-icon-delete",attrs:{id:"gv-draw-delete",title:"Cancella",size:"mini"},on:{click:function(t){e.draw("delete")}}})],1),e._v(" "),e._c("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"left"}},[e._c("el-checkbox",{on:{change:e.setSnapInteraction},model:{value:e.snap,callback:function(t){e.snap=t},expression:"snap"}},[e._v("Snap")])],1),e._v(" "),e._c("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"left"}},[e._c("el-button",{staticClass:"gv-color-scheme",attrs:{id:"gv-draw-submit",title:"Salva i dati sul DB",size:"mini"},on:{click:e.confirmSubmit}},[e._v("Salva")]),e._v(" "),e._c("el-button",{directives:[{name:"show",rawName:"v-show",value:e.cancelButton,expression:"cancelButton"}],staticClass:"gv-color-scheme",attrs:{id:"gv-draw-cancel",title:"Ritorno alla applicazione",size:"mini"},on:{click:e.cancel}},[e._v("Annulla")]),e._v(" "),e._c("el-button",{directives:[{name:"show",rawName:"v-show",value:e.refreshButton,expression:"refreshButton"}],staticClass:"gv-color-scheme",attrs:{id:"gv-draw-cancel",title:"Ricarica dati salvati sul DB",size:"mini"},on:{click:e.confirmRefresh}},[e._v("Ricarica")])],1),e._v(" "),e.showVertexEditor?e._c("div",{staticClass:"gv-draw-vertex-editor gv-inverted-color-scheme"},[e._c("el-row",[e._c("b",[e._v("EDITOR VERTICI")])]),e._v(" "),e._c("el-row",[e._v("\n        X: "),e._c("el-input",{staticStyle:{width:"80px"},attrs:{size:"mini",placeholder:"X"},model:{value:e.vertexX,callback:function(t){e.vertexX=t},expression:"vertexX"}}),e._v("\n        Y: "),e._c("el-input",{staticStyle:{width:"80px"},attrs:{size:"mini",placeholder:"Y"},model:{value:e.vertexY,callback:function(t){e.vertexY=t},expression:"vertexY"}})],1),e._v(" "),e._c("el-row",[e._c("el-button",{staticClass:"gv-color-scheme",attrs:{id:"gv-draw-vertex-editor-submit",title:"Modifica Vertice",size:"mini"},on:{click:e.submitVertexEditor}},[e._v("Modifica")]),e._v(" "),e._c("el-button",{staticClass:"gv-color-scheme",attrs:{id:"gv-draw-vertex-editor-cancel",title:"Annulla Modifica Vertice",size:"mini"},on:{click:e.cancelVertexEditor}},[e._v("Annulla")])],1)],1):e._e()],1)},staticRenderFns:[]}}});
//# sourceMappingURL=34.js.map