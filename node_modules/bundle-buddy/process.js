"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const sourceMap = require("source-map");
const fs = require("fs");
const path = require("path");
const graph_builder_1 = require("./graph_builder");
const utils_1 = require("./utils");
/*
 * Generates a mapping from source files to grouped lines by common bundle use.
 */
function generateGroupedFileStats(fileStats) {
    const ret = {};
    for (const sourceFileName of fileStats.keys()) {
        if (ret[sourceFileName] === undefined) {
            ret[sourceFileName] = {};
        }
        for (const lineNumber of Object.keys(fileStats.get(sourceFileName))) {
            const lineNumberInt = parseInt(lineNumber, 10);
            const lineInfo = fileStats.get(sourceFileName)[lineNumberInt];
            if (ret[sourceFileName][utils_1.hashBundlesToKey(lineInfo.inBundles)] === undefined) {
                ret[sourceFileName][utils_1.hashBundlesToKey(lineInfo.inBundles)] = {
                    lines: [],
                    bundles: lineInfo.inBundles,
                    sourceName: sourceFileName
                };
            }
            ret[sourceFileName][utils_1.hashBundlesToKey(lineInfo.inBundles)].lines.push(lineNumberInt);
        }
    }
    return ret;
}
function doBundlesHaveDuplication(bundleToSources) {
    for (let bundle of bundleToSources.values()) {
        for (let sourceFileName of Object.keys(bundle)) {
            if (bundle[sourceFileName].inBundleCount > 1) {
                return true;
            }
        }
    }
    return false;
}
function extractHitInto(sourceFiles, sourcePath) {
    const map = fs.readFileSync(path.resolve(sourcePath), "utf-8");
    const sourceMapConsumer = new sourceMap.SourceMapConsumer(map);
    sourceMapConsumer.computeColumnSpans();
    const usedSourceInfo = new Map();
    sourceMapConsumer.eachMapping(info => {
        // sometimes source is null, which is strange... skip it for now.
        if (info.source === null) {
            return;
        }
        const realFilePath = utils_1.getOriginalFileNameFromSourceName(info.source, sourceMapConsumer);
        // If this is the first time we are seeing the file, setup the tracking object.
        if (!usedSourceInfo.has(realFilePath)) {
            const sourceLines = sourceMapConsumer
                .sourceContentFor(info.source)
                .split("\n");
            sourceFiles[realFilePath] = {
                sourceLines: sourceLines.length,
                source: sourceLines
            };
            usedSourceInfo.set(realFilePath, {
                sourceName: realFilePath,
                inUse: {}
            });
        }
        const prev = usedSourceInfo.get(realFilePath).inUse[info.originalLine] || {
            line: info.originalLine,
            columns: {},
            lineHits: 1
        };
        if (prev.columns[info.originalColumn] === undefined) {
            prev.columns[info.originalColumn] = [];
        }
        prev.columns[info.originalColumn].push({
            generatedColumn: info.generatedColumn,
            generatedLine: info.generatedLine
        });
        usedSourceInfo.get(realFilePath).inUse[info.originalLine] = prev;
    });
    return usedSourceInfo;
}
function processSourceMaps(bundleSourceMaps, opts = { logLevel: "silent" }) {
    opts.logLevel = opts.logLevel || "silent";
    const logger = new utils_1.Logger(opts);
    // Mapping from Source Files to Bundle files
    const sourceToBundles = {};
    const lineHitMap = new Map();
    const sourceFiles = {};
    const bundleToSources = new Map();
    const perFileStats = new Map();
    const sourceFileToGrouped = new Map();
    if (bundleSourceMaps.length === 0) {
        logger.error("Fatal Error: no source maps passed :(");
        process.exit(1);
    }
    // Calculate a source line to bundle mapping hash
    for (const sourceMap of bundleSourceMaps) {
        logger.info(`Processing ${sourceMap}`);
        let hitInfo;
        try {
            hitInfo = extractHitInto(sourceFiles, sourceMap);
        }
        catch (e) {
            logger.error(`Error processing ${sourceMap}, ${e}`);
            continue;
        }
        const bundleHits = utils_1.sourceMapToLineHits(hitInfo);
        for (let hit of bundleHits) {
            if (lineHitMap.get(hit) === undefined) {
                lineHitMap.set(hit, {
                    from: [],
                    count: 0
                });
            }
            lineHitMap.get(hit).from.push(path.basename(sourceMap));
            lineHitMap.get(hit).count++;
        }
    }
    for (const lineHash of lineHitMap.keys()) {
        const match = lineHitMap.get(lineHash);
        const details = utils_1.hashToFileAndLineNumber(lineHash);
        if (!perFileStats.has(details.fileName)) {
            perFileStats.set(details.fileName, {});
        }
        if (!sourceFileToGrouped.has(details.fileName)) {
            sourceFileToGrouped.set(details.fileName, {});
        }
        for (const bundle of match.from) {
            const bundleStats = bundleToSources.get(bundle);
            if (!bundleStats) {
                bundleToSources.set(bundle, {});
            }
            const bundleFileStats = bundleToSources.get(bundle)[details.fileName];
            if (!bundleFileStats) {
                bundleToSources.get(bundle)[details.fileName] = {
                    inBundleCount: Array.from(match.from).length,
                    containedInBundles: Array.from(match.from),
                    count: 0
                };
            }
            bundleToSources.get(bundle)[details.fileName].count++;
        }
        const prevBundleCount = (sourceFileToGrouped.get(details.fileName)[utils_1.hashBundlesToKey(match.from)] || {
            count: 0
        }).count;
        sourceFileToGrouped.get(details.fileName)[utils_1.hashBundlesToKey(match.from)] = {
            count: prevBundleCount + 1,
            files: match.from.length
        };
        perFileStats.get(details.fileName)[details.lineNumber] = {
            sourceFile: details.fileName,
            sourceLine: details.lineNumber,
            inBundles: Array.from(match.from)
        };
        if (!sourceToBundles[details.fileName]) {
            sourceToBundles[details.fileName] = new Set(Array.from(match.from));
        }
        else {
            sourceToBundles[details.fileName] = new Set(Array.from(match.from).concat(Array.from(sourceToBundles[details.fileName])));
        }
    }
    if (Array.from(lineHitMap.keys()).length === 0) {
        logger.error("No bundle source maps were processed.");
        process.exit(1);
    }
    if (!doBundlesHaveDuplication(bundleToSources)) {
        logger.success("No bundle duplication detected ðŸ“¯.");
        process.exit(1);
    }
    return {
        graph: graph_builder_1.buildGraph(sourceFileToGrouped, bundleToSources, sourceToBundles, logger),
        sourceFiles,
        perFileStats,
        sourceFileLinesGroupedByCommonBundle: generateGroupedFileStats(perFileStats),
        // Bundle to source file line use
        bundleFileStats: bundleToSources,
        outputFiles: bundleSourceMaps.map(f => path.basename(f)),
        groupedBundleStats: sourceFileToGrouped
    };
}
exports.processSourceMaps = processSourceMaps;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvY2Vzcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInByb2Nlc3MudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSx3Q0FBd0M7QUFDeEMseUJBQXlCO0FBQ3pCLDZCQUE2QjtBQUM3QixtREFBNkM7QUFhN0MsbUNBTWlCO0FBRWpCOztHQUVHO0FBQ0gsa0NBQWtDLFNBQXVCO0lBQ3ZELE1BQU0sR0FBRyxHQUF5QyxFQUFFLENBQUM7SUFFckQsR0FBRyxDQUFDLENBQUMsTUFBTSxjQUFjLElBQUksU0FBUyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQztRQUM5QyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsY0FBYyxDQUFDLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQztZQUN0QyxHQUFHLENBQUMsY0FBYyxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBQzNCLENBQUM7UUFFRCxHQUFHLENBQUMsQ0FBQyxNQUFNLFVBQVUsSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDcEUsTUFBTSxhQUFhLEdBQUcsUUFBUSxDQUFDLFVBQVUsRUFBRSxFQUFFLENBQUMsQ0FBQztZQUMvQyxNQUFNLFFBQVEsR0FBRyxTQUFTLENBQUMsR0FBRyxDQUFDLGNBQWMsQ0FBRSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1lBRS9ELEVBQUUsQ0FBQyxDQUNELEdBQUcsQ0FBQyxjQUFjLENBQUMsQ0FBQyx3QkFBZ0IsQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUMsS0FBSyxTQUNoRSxDQUFDLENBQUMsQ0FBQztnQkFDRCxHQUFHLENBQUMsY0FBYyxDQUFDLENBQUMsd0JBQWdCLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEdBQUc7b0JBQzFELEtBQUssRUFBRSxFQUFFO29CQUNULE9BQU8sRUFBRSxRQUFRLENBQUMsU0FBUztvQkFDM0IsVUFBVSxFQUFFLGNB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