'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

exports.default = makeAlgoliaPlacesWidget;

var _places = require('../places.js');

var _places2 = _interopRequireDefault(_places);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _objectWithoutProperties(obj, keys) { var target = {}; for (var i in obj) { if (keys.indexOf(i) >= 0) continue; if (!Object.prototype.hasOwnProperty.call(obj, i)) continue; target[i] = obj[i]; } return target; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

/**
 * The underlying structure for the Algolia Places instantsearch widget.
 */
var AlgoliaPlacesWidget = function () {
  function AlgoliaPlacesWidget(_ref) {
    var _ref$defaultPosition = _ref.defaultPosition,
        defaultPosition = _ref$defaultPosition === undefined ? [0, 0] : _ref$defaultPosition,
        placesOptions = _objectWithoutProperties(_ref, ['defaultPosition']);

    _classCallCheck(this, AlgoliaPlacesWidget);

    this.defaultPosition = defaultPosition.join(',');
    this.placesOptions = placesOptions;
  }

  _createClass(AlgoliaPlacesWidget, [{
    key: 'init',
    value: function init(_ref2) {
      var _this = this;

      var helper = _ref2.helper;

      var placesAutocomplete = (0, _places2.default)(this.placesOptions);

      helper.setQueryParameter('aroundLatLng', this.defaultPosition);

      placesAutocomplete.on('change', function (opts) {
        var _opts$suggestion$latl = opts.suggestion.latlng,
            lat = _opts$suggestion$latl.lat,
            lng = _opts$suggestion$latl.lng;

        helper.setQueryParameter('aroundLatLng', lat + ',' + lng).search();
      });

      placesAutocomplete.on('clear', function () {
        helper.setQueryParameter('aroundLatLng', _this.defaultPosition).search();
      });
    }
  }]);

  return AlgoliaPlacesWidget;
}();

/**
 * Creates a new instance of the Algolia Places widget. This widget
 * sets the geolocation value for the search based on the selected
 * result in the Algolia Places autocomplete. If the input is cleared,
 * the position is result to the default position.
 * @function
 * @param {object} opts configuration object
 * @param {number[]} opts.defaultPosition=[0,0] default position as an array of the form [lat, lng]
 * @returns {Widget} the algolia places widget
 */


function makeAlgoliaPlacesWidget(opts) {
  return new AlgoliaPlacesWidget(opts);
}