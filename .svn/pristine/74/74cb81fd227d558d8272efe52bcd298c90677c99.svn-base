
var query = decodeURIComponent(GV.Util.getUrlParam('q'));
if (query === "null") {
    query = "*";
} else {
    query = "*" + query + "*"
}

var popupTemplate = '<p><b>{toponimo}</b></p><p>{comune}</p>';

var config = {
    application: {
        layout: {
            controls: [],
            toolbar: [
                {
                    position: "bottomright",
                    items: [
                        {name: "zoom"}
                    ]
                }
            ]
        }
    },
    baseLayers: [
        { 'type': "MAPBOX_LIGHT", visible: true }
    ],
    maps: [
        {
            id: 100001,
            name: "Toponimi",
            layers: [
                {
                    type: 'JSON',
                    dataType: 'json',
                    cluster: {
                        options: {
                            showCoverageOnHover: false,
                            maxClusterRadius: 50
                        }
                    },
                    name: 'toponimi',
                    visible: true,
                    geomSubType: 'POINT',
                    esParams: {
                        url: 'http://bv8prod1.datasiel.net:9200/repcarto_pub/toponimo/_search',
                        field: 'toponimo',
                        query: query
                    },
                    legend: {
                        label: 'Toponimi'
                    },
                    tooltip: '{toponimo}',
                    popup: popupTemplate,
                    classes: [
                        {
                            name: "toponimi",
                            style: {
                                iconUrl: 'default-small'
                            }
                        }
                    ]
                }
            ]
        }

    ]
};

function cb(app) {
    "use strict";

    /*
     app.map.on('click', function () {
     app.map.getLayerByName("scuole").filter([
     { key: 'TIPO', value: '01' },
     { key: 'TIPO', value: '02' }
     ]);
     });
     */

    app.addButton({
        name: "search",
        options: {
            layers: ["toponimi"],
            propertyName: 'toponimo',
            textPlaceholder: 'Ricerca...',
            position: 'topleft',
            circleLocation: false,
            collapsed: false,
            autoCollapse: false,
            autoResize: false,
            moveToLocation: function(latlng, title, map) {
                map.setView(latlng, 16);
            }
        }
    });

    // Visualizzo logo
    if (!GV.Globals.SMALL_SCREEN) {
        $('#gv-container').append("<div id='gv-title'></div>");
    }


}

var app = new GV.App({
    el: '#mapdiv',
    config: config,
    callback: cb,
    debug: true
});

